<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signin Page</title>
    <link rel="stylesheet" href="../styles/sign.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <form action="" method="" id="login-form">
        <p id="message"></p>
        <h2>Signin</h2>

        <label for="username">Enter your username</label>
        <input type="text" id="username" name="username" required>

        <label for="password">Enter your password</label>
        <input type="password" id="password" name="password" required>

        <button type="submit">Signin</button>

        <div class="extra-links">
            <a href="#">Forgot Password?</a>
            <span class="separator">|</span>
            <a href="/">Create an account</a>
        </div>
    </form>

    <script>
        async function loginHandler(e) {
            e.preventDefault();
            const username = e.target.elements.username.value;
            const password = e.target.elements.password.value;
            // console.log(username, password);
            try {
                const response = await axios.post("/signin", { username, password });
                localStorage.setItem('token', response.data.token);
                window.location.href = "/todo";
            }
            catch (err) {
                // console.log(err.response.data);
                let heading = document.createElement("p");
                heading.innerHTML = err.response.data.message;
                let parent = document.getElementById("message")
                parent.appendChild(heading);
                if (err.response.data.error) {
                    // console.log(err.response.data.error)
                    let list = document.createElement("ul");
                    err.response.data.error.forEach(element => {
                        let listitem = document.createElement('li');
                        listitem.innerHTML = element.message;
                        list.appendChild(listitem);
                    });
                    parent.appendChild(list);
                }

            }


        }
        // const username = document.getElementById("username").innerHTML;
        // const password = document.getElementById("password").innerHTML;
        document.getElementById("login-form").addEventListener("submit", loginHandler)
    </script>
</body>

</html>